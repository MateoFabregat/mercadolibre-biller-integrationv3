# ============================================================
# BILLER - Facturación Electrónica
# ============================================================
# Ambiente: 'test' o 'production'
BILLER_ENVIRONMENT=test

# Token de autenticación (obtener de Biller)
BILLER_TOKEN=

# ID de la empresa en Biller
BILLER_EMPRESA_ID=

# RUT de la empresa (12 dígitos)
BILLER_EMPRESA_RUT=

# ID de sucursal (opcional)
BILLER_EMPRESA_SUCURSAL=

# Nombre de la empresa (para emails)
BILLER_EMPRESA_NOMBRE=Mi Empresa

# ============================================================
# SHOPIFY
# ============================================================
# Nombre de la tienda (sin .myshopify.com)
SHOPIFY_SHOP=mi-tienda

# Credenciales de la App (Settings > Apps > Develop apps)
SHOPIFY_API_KEY=
SHOPIFY_API_SECRET=

# Access Token (se obtiene en /install)
SHOPIFY_ACCESS_TOKEN=

# Versión de API (opcional)
SHOPIFY_API_VERSION=2024-01

# ============================================================
# SERVIDOR
# ============================================================
# Puerto local
SERVER_PORT=3000

# URL pública (Render en producción)
SERVER_PUBLIC_URL=https://mercadolibre-biller-integrationv3.onrender.com

# Timeout para shutdown graceful (ms)
SHUTDOWN_TIMEOUT=10000

# ============================================================
# FACTURACIÓN
# ============================================================
# Validar RUT con DGI antes de emitir e-Factura
VALIDAR_RUT_CON_DGI=true

# Enviar comprobante al email del cliente
ENVIAR_COMPROBANTE_CLIENTE=true

# Agregar nota con link al comprobante en el pedido
AGREGAR_LINK_EN_PEDIDO=true

# ============================================================
# REGLA 5000 UI (DGI Uruguay)
# ============================================================
# Límite en UI para requerir identificación del comprador
# Ventas mayores a este límite requieren e-Factura con RUT
LIMITE_UI_ETICKET=5000

# Valor de la UI en UYU (actualizar según BPC)
# Consultar: https://www.bps.gub.uy/10310/
VALOR_UI_UYU=6.0383

# Límite calculado en UYU (LIMITE_UI_ETICKET * VALOR_UI_UYU)
# Este valor se calcula automáticamente, pero puede sobrescribirse
# LIMITE_UYU_ETICKET=30191

# ============================================================
# PROCESAMIENTO
# ============================================================
# Máximo de webhooks procesando simultáneamente
MAX_CONCURRENT_WEBHOOKS=3

# Ventana de deduplicación de webhooks (ms)
DEDUPE_WINDOW=300000

# ============================================================
# PERSISTENCIA
# ============================================================
# Archivo para guardar comprobantes
STORAGE_FILE=./data/comprobantes.json

# Auto-guardar cada N segundos
AUTO_SAVE_INTERVAL=30

# ============================================================
# LOGGING
# ============================================================
# Nivel: error, warn, info, debug
LOG_LEVEL=info

# Formato: pretty o json
LOG_FORMAT=pretty

# ============================================================
# RECONCILIACIÓN
# ============================================================
# Habilitar reconciliación automática
RECONCILIATION_ENABLED=true

# Intervalo de reconciliación automática (ms) - default 1 hora
RECONCILIATION_INTERVAL=3600000

# ============================================================
# CACHE
# ============================================================
# TTL del cache de búsquedas Biller (ms) - default 5 minutos
CACHE_TTL=300000

# Tamaño máximo del cache (entradas)
CACHE_MAX_SIZE=1000

# ============================================================
# AUDITORÍA
# ============================================================
# Habilitar logs de auditoría
AUDIT_ENABLED=true

# Archivo de auditoría
AUDIT_FILE=./data/audit.log

# ============================================================
# PDF WORKER
# ============================================================
# Máximo de reintentos para envío de PDF
PDF_MAX_RETRIES=3

# Delay entre reintentos (ms)
PDF_RETRY_DELAY=5000

# ============================================================
# CIRCUIT BREAKER
# ============================================================
# Umbral de fallos para abrir el circuito
CIRCUIT_FAILURE_THRESHOLD=5

# Tiempo en estado OPEN antes de probar (ms)
CIRCUIT_RESET_TIMEOUT=30000

# Umbral de éxitos en HALF_OPEN para cerrar
CIRCUIT_SUCCESS_THRESHOLD=2
